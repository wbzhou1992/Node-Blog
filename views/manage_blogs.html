{% extends '__base__.html' %} {% block title %}编辑博客{% endblock %} 

{% block beforehead %}


<script>
(function(){
    function showError(resp) {
        resp.json().then(function (result) {
            console.log('Error: ' + result.message);
        });
    }
    window.onload = function(){

        var vm = new Vue({
            el: '#vm',
            data: {
                blogs:'',
                currentPage:1,
                pageSize:10,
                pageCount:0,
                loading:true
            },
            created(){
                this.init();
                this.loading = false
            },
            components:{
                'vue-nav': Vnav
            },
            methods: {
                init: function () {
                    var that = this;
                    that.$resource('/api/blogs?pageSize='+that.pageSize+'&currentPage='+that.currentPage).get().then(function (resp) {
                            resp.json().then(function (result) {
                                that.blogs = result.blogs;
                                that.pageCount = result.pageCount
                                console.log(that.blogs);
                            });
                        }, showError);
                },
                editBlog:function(blog){
                    location.assign('/manage/blogs/edit?id=' + blog.id);
                },
                deleteBlog: function (blog) {
                    var that = this;
                    if (confirm('确认要删除' + blog.name + '？删除后不可恢复！')) {
                        that.$resource('/api/blogs/'+blog.id+'/delete').delete().then(function (resp) {
                            resp.json().then(function (result) {
                                that.init();
                            });
                        }, showError);
                    }
                },
                callback(page){
                    this.currentPage = page;
                    this.init();
                }
            }
        });
    }
})()
</script>

{%  endblock %}
{% block content %}

    <div class="uk-width-1-1 uk-margin-bottom">
        <div class="uk-panel uk-panel-box">
            <ul class="uk-breadcrumb">
                <li class="uk-active"><span>博客</span></li>
            </ul>
        </div>
    </div>

    <div id="error" class="uk-width-1-1">
    </div>


    <div id="vm" class="uk-width-1-1">
        <a href="/manage/blogs/create" class="uk-button uk-button-primary"><i class="uk-icon-plus"></i> 新博客</a>
        <div v-if="loading" class="uk-width-1-1 uk-text-center">
            <span><i class="uk-icon-spinner uk-icon-medium uk-icon-spin"></i> 正在加载...</span>
        </div>
        <table class="uk-table uk-table-hover">
            <thead>
                <tr>
                    <th class="uk-width-5-10">标题 / 摘要</th>
                    <th class="uk-width-2-10">作者</th>
                    <th class="uk-width-2-10">创建时间</th>
                    <th class="uk-width-1-10">操作</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="blog in blogs" >
                    <td>
                        <a target="_blank" v-bind:href="'/blog/'+blog.id" v-text="blog.name"></a>
                    </td>
                    <td>
                        <a href="#0">北岛</a>
                    </td>
                    <td>
                        <span v-text="blog.createdAt.toDateTimeString()"></span>
                    </td>
                    <td>
                        <a href="#0" v-on:click="editBlog(blog)"><i class="uk-icon-edit"></i></a> 
                        <a href="#0" v-on:click="deleteBlog(blog)"><i class="uk-icon-trash-o"></i></a>
                    </td>
                </tr>
            </tbody>
        </table>
        <vue-nav :cur="currentPage" :all="pageCount" :callback="callback"></vue-nav>

    </div>

{% endblock %}
