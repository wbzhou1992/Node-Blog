{% extends '__base__.html' %} {% block title %}编辑博客{% endblock %}



{% block beforehead %}

<script>
    $(function () {
        var ID = '{{id}}',
        action = '/api/blogs/' + ID;
        console.log(ID);
    function showError(resp) {
        resp.json().then(function (result) {
            console.log('Error: ' + result.message);
        });
    }
        var vm = new Vue({
            el: '#vm',
            data: {
                name:'',
                summary:'',
                content:''
            },
            created: function () {
                if(ID){
                   this.init();
                }
                $("#loading").hide();
            },
            methods: {
                init: function () {
                    var that = this;
                    that.$resource('/api/blogs/' + ID).get().then(function (resp) {
                        resp.json().then(function (result) {
                            that.name = result.name;
                            that.content= result.content;
                            that.summary = result.summary;
                            console.log(result);
                        });
                    }, showError);
                },
                createBlog:function(){
                    var that = this;
                    that.$resource('/api/blogs').save(that.$data).then(function(resp){
                        resp.json().then(function (result) {
                            console.log(resp);
                            });
                    },showError);
                },
                updateBlog:function(){
                    var that = this;
                    that.$resource(action).update(that.$data).then(function(resp){
                        console.log(`Update ${resp}`);
                    },showError);
                },
                saveBlog:function(){
                    var that = this;
                    ID ? that.updateBlog() : that.createBlog();
                },
                submit:function(event){ 
                    event.preventDefault();             
                    var that = this;
                    that.saveBlog();
                    location.assign('/manage/blogs');
                    console.log(that.name);
                    console.log(that.summary);
                    console.log(that.content);
                }
            }
        });
        $("#vm").show();
    })

</script>

{% endblock %} {% block content %}

<div class="uk-width-1-1 uk-margin-bottom">
    <div class="uk-panel uk-panel-box">
        <ul class="uk-breadcrumb">
            <li><a href="/manage/blogs">博客</a></li>
        </ul>
    </div>
</div>

<div id="error" class="uk-width-1-1">
</div>

<div id="loading" class="uk-width-1-1 uk-text-center">
    <span><i class="uk-icon-spinner uk-icon-medium uk-icon-spin"></i> 正在加载...</span>
</div>

<div id="vm" class="uk-width-2-3">
    <form v-on:submit="submit" class="uk-form uk-form-stacked">
        <div class="uk-alert uk-alert-danger uk-hidden"></div>
        <div class="uk-form-row">
            <label class="uk-form-label">标题:</label>
            <div class="uk-form-controls">
                <input v-model="name" name="name" type="text" placeholder="标题" class="uk-width-1-1">
            </div>
        </div>
        <div class="uk-form-row">
            <label class="uk-form-label">摘要:</label>
            <div class="uk-form-controls">
                <textarea v-model="summary" rows="4" name="summary" placeholder="摘要" class="uk-width-1-1" style="resize:none;"></textarea>
            </div>
        </div>
        <div class="uk-form-row">
            <label class="uk-form-label">内容:</label>
            <div class="uk-form-controls">
                <textarea v-model="content" rows="16" name="content" placeholder="内容" class="uk-width-1-1" style="resize:none;"></textarea>
            </div>
        </div>
        <div class="uk-form-row">
            <button type="submit" class="uk-button uk-button-primary"><i class="uk-icon-save"></i> 保存</button>
            <a href="/manage/blogs" class="uk-button"><i class="uk-icon-times"></i> 取消</a>
        </div>
    </form>
</div>

{% endblock %}